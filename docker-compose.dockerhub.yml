services:
  grok2api:
    image: skatef/grok2api:latest
    ports:
      - "9527:8000"
    volumes:
      - grok_data:/app/data
      - ./logs:/app/logs
    environment:
      # =====存储模式: file, mysql 或 redis=====
      - STORAGE_MODE=file
      # =====数据库连接 URL (仅在STORAGE_MODE=mysql或redis时需要)=====
      # - DATABASE_URL=mysql://user:password@host:3306/grok2api
      # - DATABASE_URL=redis://redis:6379/0  # 如果使用下面的 Redis 服务

      ## MySQL格式: mysql://user:password@host:port/database
      ## Redis格式: redis://host:port/db 或 redis://user:password@host:port/db
    healthcheck:
      test:
        [
          "CMD",
          "python",
          "-c",
          "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()",
        ]
      interval: 10s
      timeout: 10s # 增加超时时间
      retries: 5
      start_period: 30s
    # depends_on:
    #   - redis  # 如果使用 Redis 存储，取消注释此行

  # ===== Redis 服务（可选，推荐用于生产环境） =====
  # 取消注释以下内容以启用 Redis 存储，可大幅提升性能
  # redis:
  #   image: redis:7-alpine
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis_data:/data
  #   command: redis-server --appendonly yes
  #   healthcheck:
  #     test: ["CMD", "redis-cli", "ping"]
  #     interval: 5s
  #     timeout: 3s
  #     retries: 5

volumes:
  grok_data:
  # redis_data:  # 如果使用 Redis，取消注释此行
